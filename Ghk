private static void updateHiddenBookmarks(XWPFParagraph para, Map<String, String> bookmarkValues) {
    CTP ctp = para.getCTP();
    XmlObject[] children = ctp.selectPath("./*");

    String currentBookmarkName = null;
    int currentBookmarkId = -1;
    boolean insideBookmark = false;

    for (XmlObject obj : children) {
        if (obj instanceof CTBookmark bookmark) {
            currentBookmarkId = bookmark.getId().intValue();
            currentBookmarkName = bookmark.getName();
            insideBookmark = bookmarkValues.containsKey(currentBookmarkName);
            continue;
        }

        if (obj instanceof CTMarkupRange bookmarkEnd) {
            if (bookmarkEnd.getId().intValue() == currentBookmarkId) {
                insideBookmark = false;
                currentBookmarkName = null;
                currentBookmarkId = -1;
            }
            continue;
        }

        if (insideBookmark && obj instanceof CTR run) {
            if (run.sizeOfFldCharArray() > 0 || run.sizeOfInstrTextArray() > 0) {
                continue; // skip form control structure
            }

            for (CTText t : run.getTList()) {
                t.setStringValue(bookmarkValues.get(currentBookmarkName));
            }
        }
    }
}
